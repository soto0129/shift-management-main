# シフト自動調整システム

制約条件に基づいてスタッフのシフトを自動生成するWebアプリケーションです。

## 📋 システム概要

バイト先でのシフト作成業務を効率化するために開発しました。従来は手作業で30分以上かかっていたシフト作成を、制約条件を設定するだけで数秒で完了できるようになります。

### 開発背景

- 手作業でのシフト作成に毎週30分以上かかっていた
- スタッフの希望を考慮しきれないケースがあった
- 人員配置の偏りや連続勤務による負担が発生していた
- 人件費の計算や労働時間の管理が煩雑だった

## ✨ 主な機能

### 1. スタッフ管理
- スタッフの登録・編集・削除
- 名前、時給、週最大労働時間の管理

### 2. シフト自動生成
- 制約条件に基づく最適なシフトの自動生成
- 対応する制約条件：
  - 各日の最低・最大必要人数
  - スタッフの週最大労働時間
  - 連続勤務日数の制限（今後実装予定）

### 3. 工数分析
- スタッフ別の労働時間を可視化
- 棒グラフでの視覚的な表示
- 総労働時間と人件費の自動計算

## 🛠 技術スタック

### フロントエンド
- **Next.js 14** (App Router)
  - 理由: SSRとSEO対策、モダンなReactフレームワーク
- **JavaScript**
  - 当初JavaScriptで実装開始（TypeScript移行は今後検討）
- **Tailwind CSS**
  - 理由: 高速な開発、レスポンシブ対応が容易

### バックエンド
- **Next.js API Routes**
  - 理由: サーバーレス関数として動作、Vercelと相性が良い

### データベース
- **Supabase (PostgreSQL)**
  - 理由: PostgreSQLの堅牢性、無料枠で十分、認証機能も搭載

### 最適化エンジン
- **Python 3.9+**
  - 理由: データ分析・最適化ライブラリが豊富
- **PuLP**
  - 理由: 線形計画法による最適化、シンプルなAPI

### デプロイ
- **Vercel** (Next.js)
- **Supabase** (データベース)

## 🏗 システムアーキテクチャ

```
[ブラウザ]
    ↓ HTTPS
[Next.js (Vercel)]
    ↓
[Next.js API Routes]
    ↓
[Python最適化エンジン (PuLP)]
    ↓
[Supabase (PostgreSQL)]
```

## 📊 データベース設計

### staffテーブル
- スタッフ情報を管理

### availabilityテーブル
- 各スタッフの勤務可能時間を管理（今後実装予定）

### shiftsテーブル
- 生成されたシフト情報を保存

詳細は `database/schema.sql` を参照してください。

## 🚀 セットアップ手順

### 1. リポジトリのクローン

```bash
git clone https://github.com/yourname/shift-management.git
cd shift-management
```

### 2. 依存関係のインストール

```bash
npm install
```

### 3. 環境変数の設定

`.env.example` をコピーして `.env.local` を作成してください。

```bash
cp .env.example .env.local
```

`.env.local` を開いて、以下の情報を設定してください：

```env
NEXT_PUBLIC_SUPABASE_URL=あなたのSupabase Project URL
NEXT_PUBLIC_SUPABASE_ANON_KEY=あなたのSupabase Anon Key
```

#### Supabaseの接続情報の取得方法

1. [Supabase](https://supabase.com) にログイン
2. プロジェクトを選択
3. Settings → API
4. Project URL と anon public キーをコピー

⚠️ **重要：.env.local は絶対にGitHubにpushしないでください**

### 4. データベースのセットアップ

Supabaseの SQL Editor で `database/schema.sql` を実行してください。

### 5. Pythonの依存関係インストール

```bash
pip install pulp
```

### 6. 開発サーバー起動

```bash
npm run dev
```

http://localhost:3000 でアクセスできます。

## 💡 工夫した点

### 1. 最適化アルゴリズム

PuLPを使った線形計画法により、以下を同時に満たす最適解を探索：
- 各日の最低・最大人数
- スタッフの労働時間制限
- 公平な配分

### 2. UX配慮

- **Toast通知**: alertではなくToast通知を使用し、ユーザー体験を向上
- **ローディング表示**: データ取得中・生成中の状態を明確に表示
- **エラーメッセージ**: UI上に詳細なエラー内容を表示

### 3. セキュリティ

- **環境変数**: APIキーを環境変数で管理
- **.gitignore**: 機密情報をGitHubにpushしない設定

### 4. 保守性

- **丁寧なコメント**: 後で見返したときに「なぜこの処理か」が分かるように記述
- **シンプルな実装**: 専門学校で習った範囲で実装
- **公式の方法**: 各ライブラリの公式ドキュメント通りの実装

## 📝 開発の経緯

### 期間
約2ヶ月（2025年12月〜2026年2月）

### 開発プロセス

1. **要件定義**（2025年12月）
   - システムの目的と機能の整理
   - 技術スタックの選定
   - データベース設計

2. **設計**（2025年12月下旬）
   - ER図作成
   - API設計
   - 画面遷移図

3. **実装**（2026年1月〜2月）
   - 基本CRUD機能
   - シフト最適化ロジック
   - UI/UX改善（alert → Toast通知）

4. **テスト・改善**（2026年2月）
   - 動作確認
   - バグ修正
   - ドキュメント作成

### 学んだこと

- **線形計画法**: PuLPを使った最適化問題の解き方
- **UXの重要性**: alertでは不十分、Toast通知の方がユーザーフレンドリー
- **セキュリティの基本**: APIキーの管理方法
- **段階的な改善**: 最初から完璧を目指さず、動くものを作って改善

### 反省点と今後の展開

#### 反省点
- 開発中からGitHub管理すべきだった
- TypeScriptで最初から書くべきだった

#### 今後の展開
- TypeScript移行
- スタッフの勤務可能時間を考慮した最適化
- カレンダーUIの追加
- 通知機能（シフト確定時にメール通知など）
- モバイルアプリ版

## 📄 ライセンス

MIT License

## 👤 作成者

あなたの名前
麻生情報ビジネス専門学校 システム専攻科 AIエンジニア専攻 2年生

---

## 🔧 Vercelへのデプロイ

### 手順

1. GitHubにプッシュ
2. Vercelでプロジェクトをインポート
3. 環境変数を設定（NEXT_PUBLIC_SUPABASE_URL, NEXT_PUBLIC_SUPABASE_ANON_KEY）
4. デプロイ

⚠️ **注意**: Vercelでは`child_process`に制限があるため、Python最適化が動作しない可能性があります。その場合は以下の代替案を検討してください：
- FastAPIを別途デプロイ（Railway, Renderなど）
- JavaScriptで最適化ロジックを再実装
- Supabase Edge Functionsを使用
