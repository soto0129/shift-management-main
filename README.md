# シフト管理システム

制約条件に基づいてスタッフのシフトを自動生成するWebアプリケーションです。

## 📋 システム概要

飲食店やサービス業でのシフト作成業務を効率化するために開発しました。従来は手作業で30分以上かかっていたシフト作成を、制約条件を設定するだけで数秒で完了できます。

### 開発背景

授業でシステム開発を学ぶ中で、個人開発に挑戦したいと考えました。身の回りで解決できる課題を探したところ、過去のアルバイト先でシフト管理がアナログで非効率だったことを思い出し、このシステムを開発しました。

- 手作業でのシフト作成に毎週30分以上かかっていた
- スタッフの希望を考慮しきれないケースがあった
- 人員配置の偏りや連続勤務による負担が発生していた
- 人件費の計算や労働時間の管理が煩雑だった

## ✨ 主な機能

### 1. スタッフ管理
- スタッフの登録・編集・削除
- 名前、時給、週最大労働時間の管理

### 2. シフト自動生成
- 制約条件に基づく最適なシフトの自動生成
- 対応する制約条件：
  - 各日の最低・最大必要人数
  - 連続勤務日数の制限（3日連続まで）
  - 週あたり勤務日数の制限（5日まで）
  - シフトパターン（午前/午後/フルタイム）

### 3. シフトカレンダー
- 月間カレンダー形式でのシフト表示
- シフトの編集・削除
- 前月・次月への切り替え
- 印刷用レイアウト対応

### 4. 勤務統計
- スタッフ別の労働時間を可視化
- 棒グラフでの視覚的な表示
- 総労働時間と人件費の自動計算

## 🛠 技術スタック

| カテゴリ | 技術 | 選定理由 |
|---------|------|----------|
| フロントエンド | Next.js 14 (App Router) | SSR対応、モダンなReactフレームワーク |
| | React 18 | コンポーネント指向の開発 |
| | Tailwind CSS | 高速な開発、レスポンシブ対応が容易 |
| バックエンド | Next.js API Routes | サーバーレス関数、Vercelと相性が良い |
| データベース | Supabase (PostgreSQL) | PostgreSQLの堅牢性、無料枠で十分 |
| ホスティング | Vercel | 自動デプロイ、HTTPS標準対応 |

## 🏗 システムアーキテクチャ

```
┌─────────────────────────────────────────────────────┐
│                   クライアント層                      │
│         ブラウザ (Chrome / Edge / Safari)            │
└─────────────────────────────────────────────────────┘
                          │ HTTPS
                          ▼
┌─────────────────────────────────────────────────────┐
│                 アプリケーション層                    │
│    ┌──────────────┐    ┌──────────────────┐        │
│    │  Next.js     │    │  API Routes      │        │
│    │  Frontend    │    │  (Serverless)    │        │
│    └──────────────┘    └──────────────────┘        │
│                    Vercel                           │
└─────────────────────────────────────────────────────┘
                          │ HTTPS
                          ▼
┌─────────────────────────────────────────────────────┐
│                     データ層                         │
│              Supabase (PostgreSQL)                  │
└─────────────────────────────────────────────────────┘
```

## 📊 データベース設計

### staffテーブル
| カラム | 型 | 説明 |
|--------|-----|------|
| id | UUID | 主キー |
| name | TEXT | スタッフ名 |
| hourly_wage | INTEGER | 時給（円） |
| max_hours_per_week | INTEGER | 週最大労働時間 |
| created_at | TIMESTAMPTZ | 作成日時 |

### shiftsテーブル
| カラム | 型 | 説明 |
|--------|-----|------|
| id | UUID | 主キー |
| staff_id | UUID | スタッフID（外部キー） |
| date | DATE | シフト日付 |
| start_time | TIME | 開始時刻 |
| end_time | TIME | 終了時刻 |
| is_confirmed | BOOLEAN | 確定フラグ |
| created_at | TIMESTAMPTZ | 作成日時 |

### availabilityテーブル（勤務可能時間）
| カラム | 型 | 説明 |
|--------|-----|------|
| id | UUID | 主キー |
| staff_id | UUID | スタッフID（外部キー） |
| day_of_week | INTEGER | 曜日（0=日〜6=土） |
| start_time | TIME | 開始時刻 |
| end_time | TIME | 終了時刻 |
| priority | INTEGER | 優先度（1〜3） |

詳細は `database/schema.sql` を参照してください。

## 📁 ディレクトリ構成

```
shift-management/
├── app/
│   ├── page.js                    # ホーム画面
│   ├── layout.js                  # 共通レイアウト
│   ├── staff/page.js              # スタッフ管理
│   ├── shifts/
│   │   ├── page.js                # シフト自動生成
│   │   └── calendar/page.js       # シフトカレンダー
│   ├── analytics/page.js          # 勤務統計
│   └── api/
│       └── generate-shift/route.js # シフト生成API
├── components/
│   └── ConfirmDialog.js           # 確認ダイアログ
├── lib/
│   ├── supabase.js                # Supabaseクライアント
│   └── utils.js                   # ユーティリティ関数
├── database/
│   └── schema.sql                 # DBスキーマ
└── package.json
```

## 🚀 セットアップ手順

### 1. リポジトリのクローン

```bash
git clone https://github.com/yourname/shift-management.git
cd shift-management
```

### 2. 依存関係のインストール

```bash
npm install
```

### 3. 環境変数の設定

```bash
cp .env.example .env.local
```

`.env.local` に以下を設定：

```env
NEXT_PUBLIC_SUPABASE_URL=あなたのSupabase Project URL
NEXT_PUBLIC_SUPABASE_ANON_KEY=あなたのSupabase Anon Key
```

### 4. データベースのセットアップ

Supabaseの SQL Editor で `database/schema.sql` を実行してください。

### 5. 開発サーバー起動

```bash
npm run dev
```

http://localhost:3000 でアクセスできます。

## 🔧 シフト最適化アルゴリズム

JavaScriptでヒューリスティック（発見的）手法を実装しています。

### 処理フロー

1. 各日付に対してループ処理
2. 勤務可能なスタッフをフィルタリング
   - 連続勤務制限チェック（3日連続まで）
   - 週あたり勤務制限チェック（5日まで）
3. スコア計算
   - 勤務回数が少ないスタッフを優先（公平性）
   - ランダム要素を追加（多様性）
4. スコア順にソートして割り当て
5. シフトパターン（午前/午後/フル）をランダム選択

### 対応する制約条件

| 制約 | デフォルト値 |
|------|-------------|
| 1日あたり最低人数 | 2名 |
| 1日あたり最大人数 | 3名 |
| 連続勤務上限 | 3日 |
| 週あたり勤務上限 | 5日 |

## 💡 工夫した点

### 1. Vercel無料プランでの実装
当初はPython（PuLP）で最適化を実装しようとしましたが、Vercelの無料プランでは動作しないことが判明。JavaScriptで独自のアルゴリズムを実装して解決しました。

### 2. UX配慮
- **Toast通知**: alertではなくToast通知を使用し、ユーザー体験を向上
- **ローディング表示**: データ取得中・生成中の状態を明確に表示
- **確認ダイアログ**: 削除時は確認ダイアログを表示

### 3. 公平なシフト割り当て
単純なローテーションではなく、スコアリング方式を採用。勤務回数が少ないスタッフを優先しつつ、ランダム要素も加えて多様なシフトを生成します。

### 4. シンプルなUI
白ベースのクリーンなデザインで、誰でも直感的に操作できるUIを心がけました。

## 📝 開発の経緯

### 期間
約2ヶ月（2025年12月〜2026年2月）

### 開発プロセス

1. **要件定義**（2025年12月）
   - システムの目的と機能の整理
   - 技術スタックの選定

2. **設計**（2025年12月下旬）
   - データベース設計
   - API設計
   - 画面設計

3. **実装**（2026年1月〜2月）
   - 基本CRUD機能
   - シフト最適化ロジック
   - カレンダー機能
   - UI/UX改善

4. **テスト・改善**（2026年2月）
   - 動作確認
   - バグ修正
   - ドキュメント作成

## 🔮 今後の展望

- [ ] ユーザー認証機能
- [ ] スタッフからの希望シフト申請機能
- [ ] LINE通知連携
- [ ] 複数店舗への対応
- [ ] CSVエクスポート機能
- [ ] TypeScript移行

## 📄 ライセンス

MIT License

## 👤 作成者

麻生情報ビジネス専門学校 情報システム専攻科 AI2 N.Souta
